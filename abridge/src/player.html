[% use Seat::*; %]
<table class="bidhistory">
    <tr>[% let who = self.game.dealer; %]
        <th>[% who.name() %]</th>
        <th>[% who.next().name() %]</th>
        <th>[% who.next().next().name() %]</th>
        <th>[% who.next().next().next().name() %]</th></tr>
    [% for row in self.game.bids.chunks(4) {
        %]<tr>[% for b in row.iter() {
            %]<td>[% b %]</td>[%
            } %]</tr>[%
    } %]
</table>
[% if Some(self.seat) == self.game.turn() { %]<audio autoplay><source src="your-play.mp3" type="audio/mpeg"></audio>[% } %]
[% if self.game.hand_done { %]
<div class="hand[% if Some(North) == self.game.dummy() { %] dummy[% } %]" id="north">[% self.game.original_hands[North] %]</div>
<div class="hand[% if Some(West) == self.game.dummy() { %] dummy[% } %]" id="west">[% self.game.original_hands[West] %]</div>
<div class="hand[% if Some(East) == self.game.dummy() { %] dummy[% } %]" id="east">[% self.game.original_hands[East] %]</div>
<div class="table"></div>
<div class="hand" id="south">[% self.game.original_hands[South] %]</div>
[% } else { %]
<div class="hand[% if Some(North) == self.game.dummy() { %] dummy[% } %][% if Some(North) == self.game.turn() { %] turn[% } %]" id="north">
    [% if self.game.names[North].len() > 0 { %]<span class="name">[% self.game.names[North] %]</span>[% } %]
    [% if self.game.hand_visible_to(North, self.seat) { self.game.playable_cards(Seat::North, self.seat) } else { %]North[% } %]
</div>
<div class="hand[% if Some(West) == self.game.dummy() { %] dummy[% } %][% if Some(West) == self.game.turn() { %] turn[% } %]" id="west">
    [% if self.game.names[West].len() > 0 { %]<span class="name">[% self.game.names[West] %]</span>[% } %]
    [% if self.game.hand_visible_to(West, self.seat) { self.game.playable_cards(Seat::West, self.seat) } else { %]West[% } %]
</div>
<div class="hand[% if Some(East) == self.game.dummy() { %] dummy[% } %][% if Some(East) == self.game.turn() { %] turn[% } %]" id="east">
    [% if self.game.names[East].len() > 0 { %]<span class="name">[% self.game.names[East] %]</span>[% } %]
    [% if self.game.hand_visible_to(East, self.seat) { self.game.playable_cards(Seat::East, self.seat) } else { %]East[% } %]
</div>
<div class="table">
    [% if let Some(lead) = self.game.lead {
        let s = (4 + Seat::North as usize - self.game.lead.unwrap() as usize) % 4;
    if s < self.game.played.len() { self.game.played[s] } else { %] <span></span> [% }
        let s = (4 + Seat::West as usize - self.game.lead.unwrap() as usize) % 4;
        if s < self.game.played.len() { self.game.played[s] } else { %] <span></span> [% }
        let s = (4 + Seat::East as usize - self.game.lead.unwrap() as usize) % 4;
        if s < self.game.played.len() { self.game.played[s] } else { %] <span></span> [% }
        let s = (4 + Seat::South as usize - self.game.lead.unwrap() as usize) % 4;
        if s < self.game.played.len() { self.game.played[s] } else { %] <span></span> [% }
     } %]
</div>
<div class="hand[% if Some(South) == self.game.dummy() { %] dummy[% } %][% if Some(South) == self.game.turn() { %] turn[% } %]" id="south">
    [% if self.game.names[South].len() > 0 { %]<span class="name">[% self.game.names[South] %]</span>[% } %]
    [% if self.game.hand_visible_to(South, self.seat) { self.game.playable_cards(Seat::South, self.seat) } else { %]South[% } %]
</div>
[% } %]
[% if self.game.bidder() == Some(self.seat) {
    %] <div class="bidboard">
        [% for &b in BIDS.iter() {
        %]<button[%
            if b == Bid::Pass {
                %] class="pass"[%
            } %][%
            if !self.game.bid_is_legal(self.seat, b) {
            %] disabled[%
            } else {
                Action::Bid(b)
            } %]>[% b %]</button>[%
        } %]
    </div>[%
} else if self.game.bidder().is_none() {
    %] <div class="tricks">
        NS: [% self.game.ns_tricks %]<br/>
        EW: [% self.game.ew_tricks %]<br/>
    </div> [%
}
%]
